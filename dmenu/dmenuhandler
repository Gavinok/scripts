#!/bin/sh
# Feed this script a link and it will give dmenu
# some choice programs to use to open it.
# TODO
# 1. Check if a program is installed before offering the option
x="$(printf "chrome\\nsurf\\nmpv\\ndownload\\nkdeconnect\\nQR\\ncast" | dmenu -i -p "Open link with what program?")"
case "$x" in
    chrome) setsid google-chrome-stable "$1" >/dev/null 2>&1 & ;;
    surf) "surf $1" >/dev/null 2>&1 & ;;
    cast) setsid cast "$1" 2>&1 ;;
    QR)  qrencode "$1" -s 10 -o /tmp/QR.png  "$1"; xdg-open /tmp/QR.png >/dev/null 2>&1 &;;
    mpv) notify-send "playing video" && mpv "$1" >/dev/null 2>&1 || notify-send "failed to play video" ;;
    kdeconnect)  kdeconnect-handler "$1" >/dev/null 2>&1 &;;
    download) 
	case "$1" in 
	    *magnet:*|*torrent*) 
	    	aria2c "$!";;
	    *youtube.com*|*youtu.be*) 
		notify-send "downloading video"
		setsid youtube-dl --add-metadata -i -o "$HOME/Downloads/%(title)s.%(ext)s" "$1" \
		    && notify-send "finished cloning" && exit
		notify-send "failed downloading";;
	    *github.com*) 
		repo=$(echo "$1" | cut -d# -f1)
		repo=${repo}.git
		notify-send "cloning repository $repo"
		git -C "$HOME/Downloads/" clone "$repo" \
		    && notify-send "finished cloning" && exit
		notify-send "failed cloning";;
	    *gitlab.com*) 
		notify-send "cloning repository"
		repo=$(echo "$1" | cut -d# -f1)
		repo=${repo}.git
		git -C "$HOME/Downloads/" clone "${1}.git"  \
		    && notify-send "finished cloning" && exit
		notify-send "failed cloning";;
	    *) 
		notify-send "downloading page"
		wget -P ~/Downloads/ "$1"   \
		    && notify-send "finished cloning" && exit
		notify-send "failed downloading";;
	esac
esac
#vim:ft=sh
